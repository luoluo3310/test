"use strict";(self["webpackChunknebula_web"]=self["webpackChunknebula_web"]||[]).push([[845],{99852:function(t,e,s){s.d(e,{Z:function(){return _}});var a=function(){var t=this,e=t._self._c;return t.item.user?e("div",{staticClass:"item",on:{click:function(e){return t.handItem(t.item)}}},[e("div",{staticClass:"item_left"},[t.item.isFocuse?e("div",{staticClass:"focus"},[e("span",{staticClass:"iconfont icon-xunhuan icon"})]):t._e(),e("div",{staticClass:"avatar",on:{click:function(e){return t.handAvatar(t.item)}}},[t.item.user?e("img",{attrs:{src:t.baseUrl+t.item.user.avatar}}):e("img",{attrs:{src:t.defaultAvatar}})])]),e("div",{staticClass:"item_right"},[t.item.isFocuse?e("div",{staticClass:"focus"},[t._v(" "+t._s(t.item.call?t.item.call:" ")+" ")]):t._e(),e("div",{staticClass:"info"},[e("span",{staticClass:"name"},[t._v(t._s(t.item.user.nickname))]),e("span",{staticClass:"time"},[t._v(t._s(t.dayjs(t.item.article.create_time).format("YYYY-MM-DD HH:mm:ss")))]),e("i",{staticClass:"el-icon-more more",on:{click:function(e){return t.handMore(t.item)}}})]),e("h3",[t._v(t._s(t.item.article.title))]),e("el-row",[t.item.article.price?e("div",{staticClass:"content play",domProps:{innerHTML:t._s(t.item.article.content)}}):e("div",{staticClass:"content",domProps:{innerHTML:t._s(t.item.article.content)}})]),t.item.article?e("el-row",{attrs:{align:"center"}},[e("el-col",{attrs:{span:6}},[e("span",{staticClass:"iconfont icon-comment-v2 icon",on:{click:function(e){return t.handComment(t.item)}}})]),e("el-col",{attrs:{span:6}},[e("span",{class:["iconfont","icon-xunhuan","icon",{" active ":t.item.isFocuse}],on:{click:function(e){return t.handFocuse(t.item)}}}),e("span",{staticClass:"num"},[t._v(t._s(t.item.article.renebula_count))])]),e("el-col",{attrs:{span:6}},[e("span",{staticClass:"iconfont icon-weiguanzhu icon",on:{click:function(e){return t.handLike(t.item)}}}),e("span",{staticClass:"num"},[t._v(t._s(t.item.article.like_count))])]),e("el-col",{attrs:{span:6}},[e("span",{staticClass:"iconfont icon-fenxiang icon",on:{click:function(e){return t.handShare(t.item)}}})])],1):t._e()],1)]):t._e()},i=[],r=s(41704),n=s(9741),o=s(24239),l=s(35085),c=s.n(l),d=s(46670),u=s.n(d);const m={},h=new(u())({network:"mainnet",cacheProvider:!0,providerOptions:m});var f={props:{val:Object},data(){return{baseUrl:r.FH,defaultAvatar:r.c1,item:this.val}},methods:{handItem(t){this.$emit("handItem",t)},async handMore(t){let e=o.Z.state.userInfo.user_address?o.Z.state.userInfo.user_address:JSON.parse(localStorage.getItem("userInfo")).user_address;if(t.article.price>0){const s=this.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});let a=await(0,n.CC)({article_id:t.article.article_id});if(0!=a.code)return s.close(),void this.$message.error(a.msg);if(a.data.is_pay)s.close(),this.goTweets(t.article,t.user,a.data.hash1);else{const a=await h.connect(),i=new(c())(a),o=new i.eth.Contract(r.OD,t.hash.contract_addr);let l=o.methods.checkPurchased(e).call({from:e}),d=o.methods.buyArticle(e).send({from:e});l.then((a=>{a?(s.close(),this.goTweets(t.article,t.user)):(this.$message.warning("Please check after paying."),d.then((async()=>{let a=o.methods.checkPurchased(e).call({from:e});a.then((async e=>{if(!e)return s.close(),void this.$message.warning("Please try again.");{let e=await(0,n.VE)({article_id:t.article.article_id});if(s.close(),0!=e.code)return void this.$message.error(e.msg);this.goTweets(t.article,t.user,e.data)}}))})).catch((t=>{s.close(),this.$message.error(t.message)})))}))}}else this.goTweets(t.article,t.user);this.$emit("handMore",t)},handAvatar(t){this.$emit("handAvatar",t)},handComment(t){this.$emit("handComment",t)},handFocuse(t){this.$emit("handFocuse",t)},handLike(t){this.$emit("handLike",t)},handShare(t){this.$emit("handShare",t)},goTweets(t,e,s=""){this.$router.push({name:"Tweets",params:{article:t,user:e,hash1:s}}),this.$bus.$emit("setHeader","Tweets")}}},v=f,p=s(43736),g=(0,p.Z)(v,a,i,!1,null,"31ed565f",null),_=g.exports},35039:function(t,e,s){s.r(e),s.d(e,{default:function(){return k}});var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"page profile"},[e("img",{staticClass:"banner",attrs:{src:t.defaultBanner,alt:""}}),e("div",{staticClass:"other"},[e("div",{staticClass:"avatarbg"},[e("img",{staticClass:"avatar",attrs:{src:t.userInfo.avatar?t.baseUrl+t.userInfo.avatar:t.defaultAvatar,alt:""}})]),e("el-button",{staticClass:"edit",attrs:{round:""},on:{click:t.handEdit}},[t._v("Edit Profile")])],1),e("div",{staticClass:"abstract"},[e("div",{staticClass:"name"},[t._v(t._s(t.userInfo.nickname))]),e("div",{staticClass:"description"},[t._v(t._s(t.userInfo.description))]),e("div",{staticClass:"time"},[e("i",{staticClass:"el-icon-date"}),t._v(" "+t._s(t.dayjs(t.userInfo.create_time).format("YYYY-MM-DD"))+" ")]),e("div",[e("span",{staticClass:"follow"},[e("span",[t._v(t._s(t.tweetsTotal))]),t._v(" Following ")])])]),e("div",{staticClass:"introduce"},[e("el-tabs",{attrs:{"tab-position":"top"},on:{"tab-click":t.handClick},model:{value:t.tabs,callback:function(e){t.tabs=e},expression:"tabs"}},[e("el-tab-pane",{attrs:{label:"Tweets",name:"tweets"}},t._l(t.tweetsList,(function(t){return e("list-item",{key:t.articleId,attrs:{val:t}})})),1),e("el-tab-pane",{attrs:{label:"Likes",name:"likes"}},t._l(t.likesList,(function(s){return e("list-item",{key:s.articleId,attrs:{val:s},on:{handAvatar:t.handAvatar}})})),1)],1)],1),e("div",{staticClass:"pagination"},[e("el-pagination",{attrs:{background:"","current-page":"tweets"==t.tabs?t.tweetsCurrent:t.likesCurrent,"page-size":10,layout:"total, prev, pager, next",total:"tweets"==t.tabs?t.tweetsTotal:t.likesTotal},on:{"current-change":t.handleCurrentChange}})],1),e("edit",{attrs:{editVisible:t.visible,userInfo:t.userInfo},on:{close:t.handClose}})],1)},i=[],r=s(99852),n=function(){var t=this,e=t._self._c;return e("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"editProfile",attrs:{visible:t.visible},on:{"update:visible":function(e){t.visible=e},close:t.handClose}},[e("el-form",{ref:"form",attrs:{model:t.form}},[e("div",{staticClass:"form_item"},[e("el-upload",{staticClass:"upload",attrs:{headers:{Authorization:t.token},action:t.baseUrl+"/api/v1/user/avatar","show-file-list":!1,"on-success":t.handleAvatarSuccess,"before-upload":t.beforeAvatarUpload}},[t.form.avatar?e("img",{staticClass:"avatar",attrs:{src:t.baseUrl+t.form.avatar}}):e("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),e("div",{staticClass:"form_item"},[e("div",{staticClass:"form_item-label"},[t._v("nickname")]),e("el-input",{staticClass:"form_item-content input",attrs:{placeholder:"Nickname"},model:{value:t.form.nickname,callback:function(e){t.$set(t.form,"nickname",e)},expression:"form.nickname"}})],1),e("div",{staticClass:"form_item"},[e("div",{staticClass:"form_item-label"},[t._v("description")]),e("el-input",{staticClass:"form_item-content input",attrs:{placeholder:"Description"},model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}})],1),e("div",{staticClass:"form_item"},[e("div",{staticClass:"form_item-label"},[t._v("user_address")]),e("el-input",{staticClass:"form_item-content input",attrs:{placeholder:"Location",disabled:""},model:{value:t.form.user_address,callback:function(e){t.$set(t.form,"user_address",e)},expression:"form.user_address"}})],1)]),e("el-button",{attrs:{type:"primary"},on:{click:t.submit}},[t._v("Submit")])],1)},o=[],l=s(41704),c=s(24239),d=s(9741);let u=localStorage.getItem("token")?localStorage.getItem("token"):c.Z.state.token;var m={props:{editVisible:Boolean,userInfo:Object},data(){return{baseUrl:l.FH,form:Object.assign({},this.userInfo),visible:this.editVisible,dialogImageUrl:"",dialogVisible:!1,disabled:!1,token:u,loading:!1}},watch:{editVisible(t){this.visible=t}},methods:{handClose(){this.$emit("close")},handleAvatarSuccess(t){0==t.code?(c.Z.commit("SET_USERINFO",t.data),this.form.avatar=t.data.avatar,this.$bus.$emit("refresh")):this.$message.error(t.msg)},beforeAvatarUpload(t){const e="image/jpeg"===t.type,s=t.size/1024/1024<2;return e||this.$message.error("上传头像图片只能是 JPG 格式!"),s||this.$message.error("上传头像图片大小不能超过 2MB!"),e&&s},async submit(){this.loading=!0;let t=await(0,d.ic)(this.form);0==t.code?(c.Z.commit("SET_USERINFO",t.data),this.$bus.$emit("refresh"),this.loading=!1,this.handClose()):this.$message.error(t.msg)}}},h=m,f=s(43736),v=(0,f.Z)(h,n,o,!1,null,"4c42fa8c",null),p=v.exports;let g=c.Z.state.userInfo?c.Z.state.userInfo:JSON.parse(localStorage.getItem("userInfo"));localStorage.setItem("userInfo",JSON.stringify(g));var _={name:"Profile",components:{ListItem:r.Z,Edit:p},mounted(){this.init(),this.$bus.$on("refresh",(()=>{this.init()})),this.$bus.$on("profileRefresh",(()=>{this.patchArticle()}))},data(){return{baseUrl:l.FH,defaultAvatar:l.c1,defaultBanner:l.J2,userInfo:g,tabs:"tweets",tweetsTotal:0,tweetsCurrent:1,likesTotal:0,likesCurrent:1,tweetsList:[],likesList:[],visible:!1}},methods:{init(){this.getUserInfo(),this.handleCurrentChange()},async patchArticle(t=1){this.tweetsList=[];let e={user_address:g.user_address,page_no:t,page_size:10},s=await(0,d.By)(e);0==s.code?(this.tweetsList=s.data.data,this.tweetsTotal=s.data.page.total):this.$message.error(s.msg)},async patchLikeArticle(t=1){this.likesList=[];let e={user_address:g.user_address,page_no:t,page_size:10},s=await(0,d.Gk)(e);0==s.code?(this.likesList=s.data.data,this.likesTotal=s.data.page.total):this.$message.error(s.msg)},async getUserInfo(){let t=await(0,d.bG)();0==t.code&&(this.userInfo=t.data,localStorage.setItem("userInfo",JSON.stringify(t.data)),c.Z.commit("SET_USERINFO",t.data))},handClick({name:t}){"tweets"!=t?this.patchLikeArticle():this.patchArticle()},handEdit(){this.visible=!0,this.userInfo=c.Z.state.userInfo},handClose(){this.visible=!1},handleCurrentChange(t){if("tweets"==this.tabs)return this.patchArticle(t),void(this.tweetsCurrent=t);this.patchLikeArticle(t),this.likesCurrent=t},handAvatar(t){if(t.user.user_address===g.user_address)return this.$router.push({name:"Profile"}),this.$bus.$emit("setHeader","Profile"),void this.$bus.$emit("setMenu","/profile");this.$router.push({name:"Other",params:{user_address:t.user.user_address}}),this.$bus.$emit("setHeader",t.user.nickname)}}},b=_,C=(0,f.Z)(b,a,i,!1,null,"2c28436f",null),k=C.exports}}]);