"use strict";(self["webpackChunknebula_web"]=self["webpackChunknebula_web"]||[]).push([[177],{99852:function(e,t,s){s.d(t,{Z:function(){return v}});var a=function(){var e=this,t=e._self._c;return e.item.user?t("div",{staticClass:"item",on:{click:function(t){return e.handItem(e.item)}}},[t("div",{staticClass:"item_left"},[e.item.isFocuse?t("div",{staticClass:"focus"},[t("span",{staticClass:"iconfont icon-xunhuan icon"})]):e._e(),t("div",{staticClass:"avatar",on:{click:function(t){return e.handAvatar(e.item)}}},[e.item.user?t("img",{attrs:{src:e.baseUrl+e.item.user.avatar}}):t("img",{attrs:{src:e.defaultAvatar}})])]),t("div",{staticClass:"item_right"},[e.item.isFocuse?t("div",{staticClass:"focus"},[e._v(" "+e._s(e.item.call?e.item.call:" ")+" ")]):e._e(),t("div",{staticClass:"info"},[t("span",{staticClass:"name"},[e._v(e._s(e.item.user.nickname))]),t("span",{staticClass:"time"},[e._v(e._s(e.dayjs(e.item.article.create_time).format("YYYY-MM-DD HH:mm:ss")))]),t("i",{staticClass:"el-icon-more more",on:{click:function(t){return e.handMore(e.item)}}})]),t("h3",[e._v(e._s(e.item.article.title))]),t("el-row",[e.item.article.price?t("div",{staticClass:"content play",domProps:{innerHTML:e._s(e.item.article.content)}}):t("div",{staticClass:"content",domProps:{innerHTML:e._s(e.item.article.content)}})]),e.item.article?t("el-row",{attrs:{align:"center"}},[t("el-col",{attrs:{span:6}},[t("span",{staticClass:"iconfont icon-comment-v2 icon",on:{click:function(t){return e.handComment(e.item)}}})]),t("el-col",{attrs:{span:6}},[t("span",{class:["iconfont","icon-xunhuan","icon",{" active ":e.item.isFocuse}],on:{click:function(t){return e.handFocuse(e.item)}}}),t("span",{staticClass:"num"},[e._v(e._s(e.item.article.renebula_count))])]),t("el-col",{attrs:{span:6}},[t("span",{staticClass:"iconfont icon-weiguanzhu icon",on:{click:function(t){return e.handLike(e.item)}}}),t("span",{staticClass:"num"},[e._v(e._s(e.item.article.like_count))])]),t("el-col",{attrs:{span:6}},[t("span",{staticClass:"iconfont icon-fenxiang icon",on:{click:function(t){return e.handShare(e.item)}}})])],1):e._e()],1)]):e._e()},i=[],n=s(41704),r=s(9741),c=s(24239),o=s(35085),l=s.n(o),h=s(46670),m=s.n(h);const u={},d=new(m())({network:"mainnet",cacheProvider:!0,providerOptions:u});var p={props:{val:Object},data(){return{baseUrl:n.FH,defaultAvatar:n.c1,item:this.val}},methods:{handItem(e){this.$emit("handItem",e)},async handMore(e){let t=c.Z.state.userInfo.user_address?c.Z.state.userInfo.user_address:JSON.parse(localStorage.getItem("userInfo")).user_address;if(e.article.price>0){const s=this.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});let a=await(0,r.CC)({article_id:e.article.article_id});if(0!=a.code)return s.close(),void this.$message.error(a.msg);if(a.data.is_pay)s.close(),this.goTweets(e.article,e.user,a.data.hash1);else{const a=await d.connect(),i=new(l())(a),c=new i.eth.Contract(n.OD,e.hash.contract_addr);let o=c.methods.checkPurchased(t).call({from:t}),h=c.methods.buyArticle(t).send({from:t});o.then((a=>{a?(s.close(),this.goTweets(e.article,e.user)):(this.$message.warning("Please check after paying."),h.then((async()=>{let a=c.methods.checkPurchased(t).call({from:t});a.then((async t=>{if(!t)return s.close(),void this.$message.warning("Please try again.");{let t=await(0,r.VE)({article_id:e.article.article_id});if(s.close(),0!=t.code)return void this.$message.error(t.msg);this.goTweets(e.article,e.user,t.data)}}))})).catch((e=>{s.close(),this.$message.error(e.message)})))}))}}else this.goTweets(e.article,e.user);this.$emit("handMore",e)},handAvatar(e){this.$emit("handAvatar",e)},handComment(e){this.$emit("handComment",e)},handFocuse(e){this.$emit("handFocuse",e)},handLike(e){this.$emit("handLike",e)},handShare(e){this.$emit("handShare",e)},goTweets(e,t,s=""){this.$router.push({name:"Tweets",params:{article:e,user:t,hash1:s}}),this.$bus.$emit("setHeader","Tweets")}}},f=p,g=s(43736),_=(0,g.Z)(f,a,i,!1,null,"31ed565f",null),v=_.exports},30574:function(e,t,s){s.r(t),s.d(t,{default:function(){return u}});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"page home"},[t("div",{staticClass:"homeList"},e._l(e.speechList,(function(s){return t("list-item",{key:s.userId,attrs:{val:s},on:{handAvatar:e.handAvatar}})})),1),t("div",{staticClass:"pagination"},[t("el-pagination",{attrs:{background:"","current-page":e.params.page_no,"page-size":10,layout:"total, prev, pager, next",total:e.total},on:{"current-change":e.handleCurrentChange}})],1)])},i=[],n=s(99852),r=s(9741),c=s(24239),o={components:{ListItem:n.Z},name:"Home",data(){return{speechList:[],params:{page_no:1,page_size:10},total:0,userInfo:c.Z.state.userInfo}},created(){this.params.page_no=1,this.init()},mounted(){this.$bus.$on("homeRefresh",(e=>{this.params.page_no=1,e?this.params.keyword=e:void 0!==this.params.keyword&&delete this.params.keyword,this.homeArticle()}))},methods:{init(){this.homeArticle()},handAvatar(e){if(e.user.user_address===this.userInfo.user_address)return this.$router.push({name:"Profile"}),this.$bus.$emit("setHeader","Profile"),void this.$bus.$emit("setMenu","/profile");this.$router.push({name:"Other",params:{user_address:e.user.user_address}}),this.$bus.$emit("setHeader",e.user.nickname)},handleCurrentChange(e){this.params.page_no=e,this.homeArticle()},async homeArticle(){this.speechList=[];let e=await(0,r.js)(this.params);0==e.code?(this.speechList=e.data.data,this.params.page_no=e.data.page.page_no,this.total=e.data.page.total):this.$message.error(e.msg)}}},l=o,h=s(43736),m=(0,h.Z)(l,a,i,!1,null,"4f35ab5b",null),u=m.exports}}]);